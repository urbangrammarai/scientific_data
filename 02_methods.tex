% conceptualisation of signature detection
    % small unit
    % complex descirption (F&F)
    % cluster analysis
The method of identification of spatial signatures consists of three top level steps.
First, we need to delineate spatial unit of analysis, one that reflects the structure of
urban phenomena on a very granular level. Then we charactercterise each of them
according to the form and function capturing the nature of each unit and its spatial
context. Finally, we use cluster analysis to derive a typology of our spatial units
that, once combined into contiguous areas, forms a typology of spatial signatures.

\subsection*{Spatial unit}
% spatial unit
    % conceptualisation of enclosed tessellation
    % rules
        % indivisible
        % internally consistent
        % geographically exhaustive
    % options
        % admin boundaries
        % arbitrary grids
        % morphological units
    % ET design
        % barriers
        % enclosures
        % anchors
        % ET cells
The first major methodological decision needs to be taken on the definition of the
spatial unit. As mentioned, it needs to reflect space in a granular manner and we argue
that it should fulfil three conditions. First, it should be \textit{indivisible},
meaning that when such a unit would be subdivided into smaller parts, none of them would
be enough to capture the nature of spatial signature. Second, it needs to be
\textit{internally consistent} - it should always reflect only a single signature type.
Last, it should be geographically \textit{exhaustive}, covering entirety of the study
area.

Spatial units used in literature can be split into three groups. One is using
administrative boundaries like city regions, wards or census output areas, that are
convenient to obatain and can be easily linked to auxiliarry data. However,
those rarely reflect the morphological composition of urban space and in some cases may
even “obscure morphologic reality” REF Taubenbock 2019. At the same time, most of them
are divisible and larger units are not alwyas internally consistent. Another group is based on
arbitrary uniform grids linked either to spatial indexing method like H3 REF or OS
National Grid REF, or to anciliarry data of remote sensing or other origins like a
WorldPop grid REF. The issue is that grids cannot be considered internally consistent as
they have no relation to the real-life spatial pattern. Finally, urban morphology tends to use morphological elements as
street segments REF, blocks REF buildings or plots as a unit of analysis. Some of those
could be seen as indivisible and internally consistent but since they are largely based
on built-up fabric, they are not exhaustive. When there is no builiding or street, there
is no spatial unit to work with. Plots could be theoretically considered as exhaustive,
consistent and indivisible but there is no accepted conceptual definition and unified
geometric representation (REF Kropf).

We are, therefore, proposing an application of an alternative spatial unit called \textit{enclosed
tessellation cell} (ETC), defined as:

\textit{A characterisation of space based on form and function designed to understand urban
environments}

% We should drop a reference to the conceptual paper here.

ETC follows the morphological tradition in a sense that is it
based on the physical elements of an enviroment but overcomes the drawbacks of
conventionally used units. Its geometry is generated in three steps illustrated on a
Figure
% \ref{fig:et_diagram}
. First, a set of features representing physical barriers
subdividing space, in our case composed of street network, railways, rivers and a
coastline, is combined together, generating a layer of boundaries. These then partition space
into smaller enclosed geometries called \textit{enclosures}, which can be very granular
or very coarse depending on the geographic context. In dense city centres where a single
enclosure represent a single block is a high frequency of small enclosures, while in the
countryside, we can observe very few large enclosures as their delimiters are far away
from each other. Enclosures are then combined with building footprints, posing as
anchors in the space and are subdivided into enclosed tessellation cells using the
morphological tessellation algorithm REF, a polygon-based adaptation of Voronoi
tessellation. Resulting geometries are indivisible as they contain, at most, a single
achor building, internally consistent due to their granularity and link to morphological
elements composing urban fabric, and geogrpahically exhasutive as they cover entire area
limited by specified boundaries.

    % data input
        % barries
            % roads from OS Open Roads
                % data description (simplified centerlines)
            % railway from OS OpenMap - Local
                % data description (simplified centerlines)
            % rivers from OS OpenRivers
                % data description (simplified centerlines)
            % coastline from OS Strategi®
                % data description (continuous enclosing geometry)
        % buildings
            % OS OpenMap - Local
            % data quality description (merged adjacent geometries)

In the case of classification of Great Britain, street networks are extracted from OS
Open Roads datasets (REF) representing simplified road centrelines cleaned of road
segments under the ground. Railways are retrieved from OS OpenMap - Local
("RailwayTrack" layer) which captures surfance railway tracks. Rivers are extracted from
OS OpenRivers (REF) representing river network of GB as centrelines, and a coastline is
retrieved from OS Strategi® (2016) REF, capturing  coastline as a continous line
geometry. Building geometry is extracted, again, from OS OpenMap - Local ("Building"
layer) and represents generalised building footprint polygons. Note that the dataset
does not distinguish between individual buildings when they are adajcent (e.g. perimeter
block composed of multiple buildings is represent by a single polygon).

% characterisation of space
\subsection*{Characterisation of space}
Spatial signatures are capturing the character of the built and unbuilt environment
based on two components - form and function. Each of them is quantified on the level of
individual ETCs using methods appropriate for the specific datasets. While form
component is described using urban morphometrics (i.e. quantitave analysis of urban
form), function is a composite of a variety of data inputs outlined in detail below.

\subsubsection*{Form}
    % form
        % input data
            % ET cells
            % bulidings
            % street network
        % morphometrics
            % different categories of characters
                % dimension
                % shape
                % spatial distribution
                % intensity
                % connectivity
                % diversity
            % different scales
                % individual elements -> adjacency -> networks
        % contextualisation
            % interest in characterisation of spatial patterns
            % distance-weighted higher order contiguity spatial weights
            % reflection of a statistical distribution of data within context
                % proxy of diversity
Morphometric characterisation of urban form is based on the numerical description
of four elements capturing the built environment - buildings, streets, ETCs, and
enclosures, and reflects their patterns based on six categories of characters - dimensions, shapes, spatial
distribution, intensity, connectivity and diversity. Each element is considered across
different scales, from the measurements of individual geometries, relations of
neighbouring geometries to graph-based analysis of street network. The combination of
elements, categories and scales results in a set of 59 individual morphometric
characters listed in the table XXX.
% Q: do we want to include some morphometric theory here? I'd say no since this is a
% data descriptor but I can add some if needed.

However, measuring individual characters is not enough to understand the predominant
spatial patterns as for some types of urban form is typical high heterogeneity. That
means that using, for example, areas of building footprints would in most cases resulted
in largely discontinous clusters. We are, therefore, representing each of the
morphometric characters using three proxy variables reflecting statistical distributions
of measured data within a spatial context of each ETC. Context is defined as
10\textsuperscript{th}
order of contiguity based on the mesh composed of contiguous ETCs. Furhtermore, each
value is weigthed by the inverse distance between so called poles of inaccessibility
(defined as a centre of a maximum inscribed circle) of each ETC. Three proxy variables
then capture the first, the second and the third quartile of the resulting weighted
distribution. Such a characterisation is able to capture the contextual tendency of each
morphometric character and hence identify contiguous clusters in both homogenous and
heterogenous urban tissues.

\subsubsection*{Function}
    % function
        % input data
            % overview - from population and POIs to NDVI and night lights
            % include table with transfer methods
        % transfer methods overview
            % blg-based interpolation
            % areal interpolation
            % accessibility
            % euclidean distance
            % zonal statistics
        % contextualisation
            % depending on the transfer method, function-based characters we
            %  contextualised using the same method used in morphometrics
Characterisation of the function component uses a different approach. While data
describing urban form are not generally available in a processed format, hence we have
to employ morphometric approaches, different aspects of function are often available as
open data products. Therefore, the main goal of our characterisation of ETCs based on
function is to develop appropriate transfer methods to link data published as grids or
linked to administrative boundaries to enclosed tessellation.

In this work we are using five different transfer methods:

\begin{itemize}
    \item Areal interpolation
    \item Building-based dasymetric areal interpolation
    \item Network-constrained accessibility
    \item Euclidean accessibility
    \item Zonal statistics
\end{itemize}

Areal interpolation is used when the functional data covers the entirety of space in a
form of polygon geometry and when there is no assumption that the phenomena it captures
is linked directly to the human population, for example land cover data. When there is
an assumption of relation to the population, building-based dasymetric areal
interpolation is used instead. The main difference is that instead of ETC polygons,
building footprint polygons linked to individual ETCs are used as a target of
interpolation. That ensures that data like population estimates are linked to ETCs
proportionally to their ability to provide accommodation, rather than by their area.
Network-constrained accessibility is used when the input data represent points of
interest like locations of supermarkets. Points are then snapped to the nearest node on
the street network and linked to the ETCs as a number of observations within 15 minutes
walking distance (1200m on the street network) and a distance to the nearest point. In
some cases, Euclidean (as-crow-flies) accessibility is measured instead to accommodate
for phenomena that are often reached outside of drivable network like water bodies.
Final method, zonal statistics, is used to transfer data originally stored in a raster
format to ETC polygons as a mean value of raster pixels intersecting each polygon
geometry. Finally, characters based on interpolation and zonal statistics are expressed
using their contextual versions following the method used for form characters to, again,
reflect the pattern of measured values. The selection of datasets and the chosen
transfer method are listed in the table XXX.

\subsection*{Cluster analysis}
% cluster analysis
    % comparison of clustering methods (shall we include this?? skip for now, keep only
    % as a notebook online)
        % K-Means, GMM, SOM

    % two levels of K-Means clustering
        % data input
            % combination of both form and function, all characters equally weighted
            % only contextualised representation of characters is used to capture pattern

            % data standardisation
                % column-based mean standardisation

When combined, contextual proxies of form and function characters (or characters
themselves when they are reflecting the context by definition) compose a dataset
describing each ETC by 331 variables (177 for form and 154 for function.) We treat all
of them equally (there is no weighting involved), standardize each variable applying
Z-score normalization and use them as an input for K-Means cluster analysis.

        % selection of number of clusters
            % clustergram
            % supplementary metrics
                % Silhouette
                % Calinski-Harabasz
                % Davies-Boulding
Due to the nature of the selected K-Means clustering the step preceeding the final
analysis is the selection of an optimal number of clusters. We use exploratory
clustergram method (REF) reflecting the behaviour of different options, the relationship
between clustering solutions regarding the allocation of individual observations to
classes and the separation between the clusters within each tested solution.
Clustergram is furhter accompanies by measures of internal validation measures - the
Silhouette score diagram, Calinski-Harabasz index and Davies-Bouldin index. The optimal
number of classes is selected based on the interpretation of clustergram supported by
additional measures aiming at a balance between cluster separation and an appropriate
detail of resulting classification.

        % top level providing a first national classification
        % sub clustering of urban areas
            % selection criteria for to-be-subclustered classes
The results of the top level clustering capture the first layer of a national signature
classification. However, since the classified ETCs cover entirety of space from vast
natural open spaces to dense city centres, it may result in only a few class
representing urban areas. While that is caused by the variable heterogeneity of our
dataset in combination with K-Means clustering, the measured characters have the ability
to further distinguish sub-classes of already identified clusters. As spatial signatures
are focused on urban environment, we furhter subdivide those clusters covering
substantial portion of urban areas using another iteration of K-Means clustering.
Resulting classification then provide two hierarchical levels capturing the typology of
spatial signatures with a detailed focus on urban development.


% generation of signature geometry
    % dissolution based on contiguity and assigned class
Finally, individual spatial signature geometries are generated as a combination of
adjacent ETCs belonging to the same signature class.

% - Feature importance - should this actually be included in here? It is not part of the
%   data product so I'd say no.